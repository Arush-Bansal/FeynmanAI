# Analysis Database Integration

This document describes the implementation of saving analysis data to the database after a user completes a practice session.

## Overview

The system now saves practice session data and analysis results to the database, enabling:
- Tracking of user practice sessions
- Storage of analysis results for review
- User progress tracking
- Analytics and insights

## Implementation Details

### 1. Practice Session Creation

When a user starts practicing, a practice session is created in the database:

**File:** `src/app/practice/PracticeClientPage.tsx`
- Creates a practice session when the component mounts
- Tracks session start time
- Stores session ID for later use

### 2. Practice Session Updates

When the user submits their explanation:

**File:** `src/app/practice/PracticeClientPage.tsx`
- Updates the practice session with transcript and duration
- Calculates session duration in seconds
- Passes session data to analysis page

### 3. Analysis Storage

When analysis is completed:

**File:** `src/app/api/feynman-analysis/route.ts`
- Receives sessionId and duration from frontend
- Transforms Gemini analysis to database format
- Saves analysis to practice session
- Updates session status to 'COMPLETED'

### 4. Database Models

**File:** `src/features/db/models/PracticeSession.ts`
- Stores user, topic, subject, exam information
- Includes transcript and duration
- Contains analysis results (score, feedback, etc.)
- Tracks session status and timestamps

### 5. API Endpoints

**File:** `src/app/api/practice-sessions/route.ts`
- `POST /api/practice-sessions` with action: 'create' - Creates new session
- `POST /api/practice-sessions` with action: 'update' - Updates session with transcript/duration
- `POST /api/practice-sessions` with action: 'complete' - Completes session with analysis
- `GET /api/practice-sessions` - Retrieves user's practice sessions

## Data Flow

1. **User starts practicing** → Practice session created in database
2. **User records explanation** → Session updated with transcript and duration
3. **User submits for analysis** → Analysis generated by Gemini AI
4. **Analysis completed** → Results saved to database, session marked complete
5. **User views history** → Can see all completed practice sessions

## Database Schema

### PracticeSession
```typescript
{
  user: ObjectId,
  concept: ObjectId,
  subtopic: ObjectId,
  topic: ObjectId,
  subject: ObjectId,
  exam: ObjectId,
  transcript: string,
  duration: number,
  analysis: {
    coveredTopics: string[],
    missedTopics: string[],
    detailedAnalysis: string,
    sideQuestions: string[],
    similarTopics: string[],
    overallScore: number,
    strengths: string[],
    weaknesses: string[],
    recommendations: string[]
  },
  status: 'IN_PROGRESS' | 'COMPLETED' | 'ABANDONED',
  startedAt: Date,
  completedAt?: Date
}
```

## Benefits

1. **Progress Tracking**: Users can see their practice history
2. **Analytics**: System can provide insights on user performance
3. **Persistence**: Analysis results are saved for future reference
4. **User Stats**: Automatic tracking of practice sessions and time
5. **Data Integrity**: Complete audit trail of user practice sessions

## Usage

The integration is automatic - no additional user action is required. When users:
1. Start practicing → Session is created
2. Submit explanation → Session is updated
3. View analysis → Results are saved
4. Check history → Can see all past sessions

## Future Enhancements

- Extract strengths/weaknesses from detailed analysis
- Add practice session analytics dashboard
- Implement session resumption for abandoned sessions
- Add practice session sharing capabilities 